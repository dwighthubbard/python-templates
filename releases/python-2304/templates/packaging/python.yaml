namespace: python-2304
name: package_python
description: Build and publish a Python package
version: 2023.4.1
maintainer: 54983+dwighthubbard@users.noreply.github.com
config:
    template: python-2304/base@latest
    order: [ begin, motd, set_artifact_envs, init_os, setup_deploy_keys, install_dependencies, init, update_version, package_code, check_packages, publish, tag_release, end, teardown-store_artifacts, teardown-storemeta]
    environment:
        TWINE_REPOSITORY_URL: https://upload.pypi.org/legacy/
        PYROMA_MIN_SCORE: 8
        PACKAGE_TAG: True
        PACKAGE_TYPES: sdist,wheel
    secrets:
        - SD_SCM_DEPLOY_KEY
        - PYPI_USER
        - PYPI_PASSWORD
        - TEST_PYPI_USER
        - TEST_PYPI_PASSWORD
        - GIT_DEPLOY_KEY
        - GIT_DEPLOY_KEY_PASSPHRASE
    steps:
        - setup_deploy_keys: |
            if [ ! -z "$GIT_DEPLOY_KEY" ]; then
                screwdrivercd_ssh_setup
                eval "$(ssh-agent -s)"
                screwdrivercd_github_deploykey
            fi
        - package_code: $BASE_PYTHON -m  screwdrivercd.packaging.build_python
        - check_packages: $BASE_PYTHON -m screwdrivercd.validation.validate_package_quality
        - publish: $BASE_PYTHON -m screwdrivercd.packaging.publish_python
        - tag_release: $BASE_PYTHON -m screwdrivercd.repo.release
